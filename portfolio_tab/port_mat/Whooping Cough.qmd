---
title: "Pertussis and Vaccination"
author: "Jared Bean"
editor: visual
execute:
  keep-md: true
format:
  html:
    self-contained: true
    code-fold: true
    code-line-numbers: true
editor_options:
  chunk_output_type: console
resource_files:
- 31_Interactive_Maps.html.md
---

```{r}
#| message: false
#| warning: false
library(tidyverse) #morning prayers XD
library(USAboundaries)
library(leaflet)
library(readxl)



## Data Wrangling for map

#Link to data
#https://data.cdc.gov/NNDSS/NNDSS-Weekly-Data/x9gk-5huc/about_data

#WANGLING! Thats one CrAzy BULL!

year <- 2024

df_map <- read_csv("C:/Users/Jared/OneDrive/Desktop/Wopping cough Data/NNDSS_Weekly_Data_20250709.csv")%>%
  
  rename("Cases" = `Cumulative YTD Current MMWR Year`)%>% #Rename col for ease of use
  
  #Clean up the geocode and make cases numeric
  mutate(
    lng = as.numeric(str_extract(geocode, "(?<=\\().+?(?=\\s)")),     # extract longitude
    lat = as.numeric(str_extract(geocode, "(?<=\\s)-?\\d+\\.\\d+")),   # extract latitude
    Cases = as.numeric(Cases)
  )%>% #ai helped with the regex

#Filter for whopping cough
  filter(Label == "Pertussis") %>% 
  filter(`Current MMWR Year` == year)%>%
  
  #finds uniq lat and lng then takes the one with the max cases
  group_by(lat,lng)%>% #finds unique combos of lat an lng
  slice_max(Cases, n = 1, with_ties = FALSE)%>% #finds max in the groups of lat lng. if theres a tie with_tie fr 1
  ungroup()%>% #unpacks the groups with just max now
  
  #get rid of na
  drop_na(lat,lng, Cases)
#Chat GPT helped with formating the wrangling for the map






## Data wrangling Deaths


#Link to data
#https://vizhub.healthdata.org/gbd-results/

# Set URL and destination
url <- "https://dl.healthdata.org:443/gbd-api-2021-public/597838c8da5e1d145ce53f7b5c9c3e9f_files/IHME-GBD_2021_DATA-597838c8-1.zip"
destfile <- "GBD_Pertussis_Data.zip"

# Download the file
download.file(url, destfile, mode = "wb")

# Unzip the file
unzip(destfile, exdir = "GBD_Pertussis_Data")

# Load the data
file_path <- "GBD_Pertussis_Data/IHME-GBD_2021_DATA-597838c8-1.csv"

df_deaths <- read_csv(file_path)







## Data wrangling for Tdap coverage


#Vaccination Coverage among Pregnant Women
#Link: https://data.cdc.gov/Pregnancy-Vaccination/Vaccination-Coverage-among-Pregnant-Women/h7pm-wmjc/about_data
#doesn't show idaho... still ok data
url <- "https://data.cdc.gov/resource/h7pm-wmjc.csv"
df_cov <- read_csv(url)%>%
  filter(vaccine == "Tdap", dimension_type == "Age") %>%
  mutate(
    coverage_estimate = as.numeric(coverage_estimate),
    year = as.numeric(str_sub(year_season, 1, 4))
  ) %>%
  filter(year <= 2020) %>%
  group_by(year) %>%
  summarise(yearly_avg_coverage = mean(coverage_estimate, na.rm = TRUE), .groups = "drop")


```

## Introduction

Are vaccines bad? With so many negative side effects, allegedly from the Covid 19 vaccine, there has been an increased loss of trust between the medical community and U.S citizens. Idaho specifically has high concentrations of individuals who are vaccine hesitant, the medical community's term for the better known label "anti-vax." Is this hesitance justified?

This report looks into one aspect of this ongoing debate about the necessity of vaccines.

Whooping Cough or Pertussis is a highly contagious respiratory infection that often afflicts newborns. According to the CDC, "Babies younger than 1 year old are at greatest risk for getting whooping cough and having severe complications from it."[^1] More than half of infants under a year of age who contract whooping cough require hospitalization.

[^1]: Centers for Disease Control and Prevention. (2024, May 17). *Pertussis (whooping cough): About*. https://www.cdc.gov/pertussis/about/index.html

A study published in the National Library of Medicine found that infants hospitalized from sever whooping cough had a mortality rate of 34.2%. [^2]

[^2]: Shi, T., Wang, L., Du, S., Fan, H., Yu, M., Ding, T., Xu, X., Zhang, D., Huang, L., & Lu, G. (2021). *Mortality risk factors among hospitalized children with severe pertussis*. BMC Infectious Diseases, 21(1), 1057. https://doi.org/10.1186/s12879-021-06732-1

## Number of Cases in the U.S During the Year 2024

```{r}
#| message: false
#| warning: false

#map visual
size <-  100
pal <- colorNumeric(palette = c("yellow", "red"), domain = df_map$Cases / size)

leaflet(data=df_map) %>% 
  addProviderTiles(providers$CartoDB.DarkMatter) %>%
  setView(lng = -98.5795, lat = 39.8283, zoom = 4)%>%
  addCircleMarkers(lng = ~lng, lat = ~lat,
                   radius = ~Cases / size,
                   label = ~paste(LOCATION1, ":", Cases, "Cases of Pertussis"),
                   fillColor = ~pal(Cases / size),
                   color = ~pal(Cases / size)
                   )
```

This map shows the number of pertussis cases by state. Small yellow circles indicate a relatively small number of cases compared to other states. Larger red circles are used for the states with a large number of cases. Locations are not geographically representative. They simply represent the total cases of the state they are in.

This map does not account for population density of a given state. It might be true that Idaho has a higher percent of their respective population reporting pertussis cases. However, this does give a general idea of where pertussis has the most effect.[^3]

[^3]: Centers for Disease Control and Prevention. (n.d.). *NNDSS weekly data*. U.S. Department of Health and Human Services. https://data.cdc.gov/NNDSS/NNDSS-Weekly-Data/x9gk-5huc/about_data

## Pertussis Deaths Over Time

```{r}
#| message: false
#| warning: false

ggplot(df_deaths, aes(x = year, y = val)) +
  geom_point(color = "#D7263D", size = 3)+
  geom_smooth(method = "loess", se = FALSE, color = "#1B9AAA", linetype = "dashed")+
  labs(title = "Pertussis Deaths Over Time",
       subtitle = "Tred based on GBD estimates for the USA",
       y = "Number of Deaths",
       x = "")+
  geom_vline(xintercept = 2010, linetype = "dashed", color = "gray30", size = 1) +

  theme_minimal()+
  theme(
    plot.title = element_text(face = "bold", size = 18),
    plot.subtitle = element_text(size = 13),
    axis.title = element_text(face = "bold"),
    panel.grid.minor = element_blank()
  )




```

To really capture the effect of pertussis on the U.S population, death estimates collected by the Global Burden of Diseases (GBD) are displayed over time in the graph above. This data covers all ages and genders.

Pertussis deaths were on the rise in the early 2000s, peaking in 2009.

The pertussis vaccine was invented in 1914. It was then combined with diphtheria and tetanus vaccines creating the DTP vaccine package in 1948. DTP was a live vaccine, because it was live it couldn't be given to pregnant women.

The vaccine was updated to DTaP. DTap was an dead vaccine, making it safer to administer. It's booster is TDaP which began to be recommended to pregnant women in the third trimester in 2010. [^4] The immunity to pertussis was transferred to the infant via the placenta, giving the infant immunity until two months of age. Pertussis is the most deadly in the first 6 weeks of life . The vaccine gave infants the immunity they needed during their most vulnerable time.[^5] This is where pertussis deaths start to decrease.

[^4]: Drugs.com. (2024, February 12). *What is the difference between DTaP and Tdap?* https://www.drugs.com/medical-answers/difference-between-dtap-tdap-3508353/

[^5]: Shi, T., Wang, L., Du, S., Fan, H., Yu, M., Ding, T., Xu, X., Zhang, D., Huang, L., & Lu, G. (2021). *Mortality risk factors among hospitalized children with severe pertussis*. BMC Infectious Diseases, 21(1), 1057. https://doi.org/10.1186/s12879-021-06732-1

## TDaP Coverage Among Pregnant Women

```{r}
ggplot(df_cov, aes(x = factor(year), y = yearly_avg_coverage)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(
    title = "Average Tdap Vaccination Coverage Among Pregnant Women by Year",
    x = "",
    y = "Average Coverage (%)"
  ) +
  theme_minimal()
```

For a more through definition of TDaP:

"TDaP contains inactivated forms of the toxin produced by the bacteria that cause these three diseases. Inactivated means that the toxin will no longer cause the disease but it does trigger the body to make antibodies that give it immunity against the toxin."[^6]

[^6]: Drugs.com. (2024, February 12). *What is the difference between DTaP and Tdap?* https://www.drugs.com/medical-answers/difference-between-dtap-tdap-3508353/

It is clear that as coverage increased deaths decreased. However, this data did not include all the U.S states mentioned in the two other graphs. In more recent years some states that were previously omitted were added in. To adjust for this the average coverage for each year was taken.[^7]

[^7]: Centers for Disease Control and Prevention. (n.d.). *Vaccination coverage among pregnant women*. U.S. Department of Health and Human Services. https://data.cdc.gov/Pregnancy-Vaccination/Vaccination-Coverage-among-Pregnant-Women/h7pm-wmjc/about_data

## Closing Thoughts

During the 2020 Covid 19 pandemic less cases of pertussis were reported. This is potentially because pertussis was mistaken for Covid 19.[^8] More research would need to be done to be sure, but it seems to be a widely accepted conclusion. This could also account for the decrease in pertussis deaths.

[^8]: Rubis, A. B., Cole, M., Tondella, M. L., Pawloski, L. C., Youngkin, E., Firmender, P., Aden, V., Cruz, V., Stanislawski, E., Wester, R., Cieslak, P. R., Acosta, A. M., & Skoff, T. H. (2024). Assessing the impact of the 2020 Council of State and Territorial Epidemiologists case definition for pertussis on reported pertussis cases. *Clinical Infectious Diseases, 78*(6), 1727–1731. https://doi.org/10.1093/cid/ciae207

Recently there has been a spike in pertussis cases in 2024. Unfortunately, much of that data hasn't been released yet.[^9]

[^9]: Centers for Disease Control and Prevention. (2025, June 11). *Pertussis surveillance and trends*. National Center for Immunization and Respiratory Diseases; Division of Bacterial Diseases. https://www.cdc.gov/pertussis/php/surveillance/index.html

In the years leading up to the pandemic it seems like the increased administration of the TDaP vaccine did lower pertussis deaths. This suggests the vaccine might be worth getting for pregnant women in their third trimester.
